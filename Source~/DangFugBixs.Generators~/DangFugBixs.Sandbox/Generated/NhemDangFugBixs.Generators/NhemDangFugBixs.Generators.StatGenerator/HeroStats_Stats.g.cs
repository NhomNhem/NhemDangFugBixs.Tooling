// <auto-generated />
using System.Collections.Generic;
using NhemDangFugBixs.Runtime.Models;

namespace NhemDangFugBixs.Sandbox;

public partial class HeroStats
{
    private readonly List<StatModifier> _attackModifiers = new();
    private bool _attackIsDirty = true;
    private float _attackCachedValue;
    
    public float AttackValue
    {
        get
        {
            if (_attackIsDirty)
            {
                _attackCachedValue = CalculateAttack();
                _attackIsDirty = false;
            }
            return _attackCachedValue;
        }
    }
    
    public void AddAttackModifier(StatModifier modifier)
    {
        _attackModifiers.Add(modifier);
        _attackIsDirty = true;
    }
    
    public void RemoveAttackModifier(StatModifier modifier)
    {
        if (_attackModifiers.Remove(modifier))
        {
            _attackIsDirty = true;
        }
    }
    
    private float CalculateAttack()
    {
        float finalValue = Attack;
        float flat = 0;
        float percentAdd = 0;
        float percentMult = 1;
        
        for (int i = 0; i < _attackModifiers.Count; i++)
        {
            var mod = _attackModifiers[i];
            switch (mod.Type)
            {
                case ModifierType.Flat: flat += mod.Value; break;
                case ModifierType.PercentAdd: percentAdd += mod.Value; break;
                case ModifierType.PercentMult: percentMult *= mod.Value; break;
            }
        }
        
        return (finalValue + flat) * (1 + percentAdd) * percentMult;
    }
    private readonly List<StatModifier> _defenseModifiers = new();
    private bool _defenseIsDirty = true;
    private float _defenseCachedValue;
    
    public float DefenseValue
    {
        get
        {
            if (_defenseIsDirty)
            {
                _defenseCachedValue = CalculateDefense();
                _defenseIsDirty = false;
            }
            return _defenseCachedValue;
        }
    }
    
    public void AddDefenseModifier(StatModifier modifier)
    {
        _defenseModifiers.Add(modifier);
        _defenseIsDirty = true;
    }
    
    public void RemoveDefenseModifier(StatModifier modifier)
    {
        if (_defenseModifiers.Remove(modifier))
        {
            _defenseIsDirty = true;
        }
    }
    
    private float CalculateDefense()
    {
        float finalValue = Defense;
        float flat = 0;
        float percentAdd = 0;
        float percentMult = 1;
        
        for (int i = 0; i < _defenseModifiers.Count; i++)
        {
            var mod = _defenseModifiers[i];
            switch (mod.Type)
            {
                case ModifierType.Flat: flat += mod.Value; break;
                case ModifierType.PercentAdd: percentAdd += mod.Value; break;
                case ModifierType.PercentMult: percentMult *= mod.Value; break;
            }
        }
        
        return (finalValue + flat) * (1 + percentAdd) * percentMult;
    }
    private readonly List<StatModifier> _movespeedModifiers = new();
    private bool _movespeedIsDirty = true;
    private float _movespeedCachedValue;
    
    public float MoveSpeedValue
    {
        get
        {
            if (_movespeedIsDirty)
            {
                _movespeedCachedValue = CalculateMoveSpeed();
                _movespeedIsDirty = false;
            }
            return _movespeedCachedValue;
        }
    }
    
    public void AddMoveSpeedModifier(StatModifier modifier)
    {
        _movespeedModifiers.Add(modifier);
        _movespeedIsDirty = true;
    }
    
    public void RemoveMoveSpeedModifier(StatModifier modifier)
    {
        if (_movespeedModifiers.Remove(modifier))
        {
            _movespeedIsDirty = true;
        }
    }
    
    private float CalculateMoveSpeed()
    {
        float finalValue = MoveSpeed;
        float flat = 0;
        float percentAdd = 0;
        float percentMult = 1;
        
        for (int i = 0; i < _movespeedModifiers.Count; i++)
        {
            var mod = _movespeedModifiers[i];
            switch (mod.Type)
            {
                case ModifierType.Flat: flat += mod.Value; break;
                case ModifierType.PercentAdd: percentAdd += mod.Value; break;
                case ModifierType.PercentMult: percentMult *= mod.Value; break;
            }
        }
        
        return (finalValue + flat) * (1 + percentAdd) * percentMult;
    }
}
